<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cosmetic Battle Pass – D&D 5e</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../global.css">
    <link rel="stylesheet" href="../../styles.css">
    <link rel="stylesheet" href="battle-pass.css">
</head>
<body>
    <div class="container battle-pass-app">
        <header class="bp-header">
            <div>
                <h1>Cosmetic Battle Pass</h1>
                <p class="intro">Level up your gear look with XP. Zero power creep—pure cosmetic flair.</p>
            </div>
            <div class="bp-header-actions">
                <a href="../../index.html" class="theme-toggle" aria-label="Hub">&#127968;</a>
                <button type="button" id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">&#127769;</button>
            </div>
        </header>

        <!-- Dashboard: Battle Pass card + At-a-glance strip | Character card -->
        <div class="bp-dashboard-row">
            <div class="bp-dashboard-left">
                <section id="bp-dashboard-hero" class="bp-dashboard-hero bp-hero-fantasy" data-level="1">
                    <div class="bp-hero-bg" aria-hidden="true"></div>
                    <div class="bp-hero-content">
                        <div class="bp-hero-top">
                            <div class="bp-level-badge" id="bp-hero-level">1</div>
                            <div class="bp-theme-name" id="bp-hero-theme">Cotton</div>
                        </div>
                        <div class="bp-progress-bar-wrap">
                            <div class="bp-progress-bar-fill" id="bp-progress-fill"></div>
                            <div class="bp-progress-bar-shine"></div>
                            <div id="bp-progress-tier-markers" class="bp-progress-tier-markers" aria-hidden="true"></div>
                        </div>
                        <div class="bp-next-unlock">
                            <div class="bp-ring-wrap">
                                <svg class="bp-ring-svg" viewBox="0 0 36 36">
                                    <circle class="bp-ring-bg" cx="18" cy="18" r="16" stroke-width="3"/>
                                    <circle class="bp-ring-fill" id="bp-ring-fill" cx="18" cy="18" r="16" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="100"/>
                                </svg>
                            </div>
                            <span class="bp-next-unlock-icon" aria-hidden="true">&#10026;</span>
                            <span id="bp-next-unlock-text">Next unlock in 75 XP (Tier 1)</span>
                        </div>
                    </div>
                </section>
                <div id="bp-at-a-glance" class="bp-at-a-glance" role="status" aria-live="polite"></div>
            </div>
            <div class="bp-dashboard-portrait">
                <div class="bp-character-card card">
                    <div class="bp-character-card-header">
                        <span id="bp-char-card-name" class="bp-char-card-name">—</span>
                        <span id="bp-char-card-class" class="bp-char-card-class hint">—</span>
                    </div>
                    <div id="bp-hero-portrait-wrap" class="bp-hero-portrait-wrap" role="button" tabindex="0" aria-label="Set portrait – click to upload">
                        <img id="bp-hero-portrait-img" class="bp-hero-portrait-img" alt="Character portrait">
                        <span id="bp-hero-portrait-placeholder" class="bp-hero-portrait-placeholder">Set portrait</span>
                    </div>
                    <input type="file" id="bp-hero-portrait-file" accept="image/*" aria-label="Set character portrait" class="bp-hero-portrait-input">
                </div>
            </div>
        </div>

        <div class="bp-tabs">
            <button type="button" class="bp-tab active" data-tab="xp">XP Level</button>
            <button type="button" class="bp-tab" data-tab="character">Character</button>
            <button type="button" class="bp-tab" data-tab="gear">Gear</button>
            <button type="button" class="bp-tab" data-tab="dashboard">Tiers</button>
            <button type="button" class="bp-tab" data-tab="generate">Generate & Gallery</button>
            <button type="button" class="bp-tab" data-tab="settings">Settings</button>
        </div>

        <div id="bp-tab-xp" class="bp-tab-content active">
            <section class="bp-form-section">
                <h2 id="bp-xp-heading">Enter current XP</h2>
                <p id="bp-xp-help" class="help-text">Set your starting XP to unlock the other tabs. This cannot be undone.</p>
                <div class="bp-xp-row">
                    <label for="bp-current-xp" id="bp-xp-label">Current XP</label>
                    <input type="number" id="bp-current-xp" min="0" value="0" placeholder="0">
                </div>
                <span id="bp-xp-error" class="bp-xp-error is-hidden"></span>
            </section>
        </div>

        <div id="bp-tab-dashboard" class="bp-tab-content">
            <section class="bp-form-section" id="bp-current-level-section">
                <h2 id="bp-current-level-heading">Your look – Level <span id="bp-current-level-num">1</span></h2>
                <p class="help-text" id="bp-current-level-hint">Toggle which tiers to include in your generated prompts.</p>
                <div id="bp-current-level-tiers" class="bp-tier-cards-grid"></div>
            </section>
            <section class="bp-form-section" id="bp-other-levels-section">
                <h2>All unlocked levels</h2>
                <div class="bp-filter-bar">
                    <input type="text" id="bp-filter-search" placeholder="Filter by level, theme, gear…" aria-label="Filter tiers">
                    <button type="button" id="bp-turn-on-all" class="btn-secondary">Turn all on</button>
                    <button type="button" id="bp-turn-off-all" class="btn-secondary">Turn all off</button>
                    <button type="button" id="bp-expand-all" class="btn-secondary">Expand all</button>
                    <button type="button" id="bp-collapse-all" class="btn-secondary">Collapse all</button>
                </div>
                <div id="bp-accordions"></div>
            </section>
        </div>

        <div id="bp-tab-character" class="bp-tab-content">
            <section class="bp-form-section">
                <h2>Character</h2>
                <div class="bp-form-group">
                    <label for="bp-char-name">Name</label>
                    <input type="text" id="bp-char-name" placeholder="Character name">
                </div>
                <div class="bp-form-group">
                    <label for="bp-char-class">Class</label>
                    <input type="text" id="bp-char-class" placeholder="e.g. Cleric">
                </div>
                <div class="bp-form-group">
                    <label for="bp-art-style">Art style</label>
                    <select id="bp-art-style" aria-label="Art style">
                        <option value="epic high-fantasy">Epic high-fantasy</option>
                        <option value="dark fantasy">Dark fantasy</option>
                        <option value="classic D&D illustration">Classic D&D illustration</option>
                        <option value="painterly fantasy">Painterly fantasy</option>
                        <option value="cinematic fantasy">Cinematic fantasy</option>
                    </select>
                </div>
                <div class="bp-form-group">
                    <label for="bp-motif">Personal motif (optional)</label>
                    <input type="text" id="bp-motif" placeholder="e.g. sunburst holy symbol">
                </div>
                <div class="bp-form-group">
                    <label>Portrait (optional)</label>
                    <button type="button" id="bp-portrait-trigger" class="btn-secondary" aria-label="Upload character portrait">Set portrait</button>
                    <p class="help-text">Used for the composite prompt: with a portrait, the app tells the AI to equip this character; without one, use the placeholder character prompt in Generate &amp; Gallery first to create a base character, then equip.</p>
                </div>
            </section>
        </div>

        <div id="bp-tab-gear" class="bp-tab-content">
            <section class="bp-form-section">
                <h2>Gear pool (min 2)</h2>
                <div class="bp-form-group">
                    <label>Your gear pool</label>
                    <p class="help-text">Click a gear below to add it here; click a chip to remove it.</p>
                    <div class="bp-gear-pool-chips" id="bp-gear-pool"></div>
                </div>
                <div class="bp-form-group">
                    <label>Add from list</label>
                    <div class="bp-gear-search">
                        <input type="text" id="bp-gear-search" placeholder="Search equipment…">
                    </div>
                    <div class="bp-gear-list" id="bp-gear-list"></div>
                </div>
                <div class="bp-form-group">
                    <label>Custom item</label>
                    <div class="bp-gear-custom-row">
                        <input type="text" id="bp-gear-custom" placeholder="Item name">
                        <button type="button" id="bp-gear-add-custom" class="btn-secondary">Add</button>
                    </div>
                </div>
                <p id="bp-gear-error" class="bp-error-msg is-hidden"></p>
            </section>
        </div>

        <div id="bp-tab-settings" class="bp-tab-content">
            <section class="bp-form-section">
                <h2>Settings</h2>
                <div class="bp-form-group">
                    <label><input type="checkbox" id="bp-sound-toggle"> Play sound on unlock</label>
                </div>
                <div class="bp-form-group bp-optional-controls">
                    <button type="button" id="bp-reseed-btn" class="bp-reseed-btn">Reseed future unlocks (new random gear/effects for next tiers only)</button>
                    <p class="help-text">Only affects tiers you haven’t unlocked yet.</p>
                </div>
                <div class="bp-form-group">
                    <button type="button" id="bp-reset-all" class="bp-reset-btn">Reset everything</button>
                </div>
                <div class="bp-form-group card bp-actions-card">
                    <h3 class="card-header">Actions</h3>
                    <button type="button" id="bp-export-json" class="btn-secondary">Export character build (JSON)</button>
                </div>
            </section>
        </div>

        <div id="bp-tab-generate" class="bp-tab-content">
            <p id="bp-generate-status" class="bp-generate-status"></p>
            <div class="bp-form-section bp-generate-api-row">
                <h2>Generate with OpenAI</h2>
                <p class="help-text">Quality and model affect cost. Default: medium, gpt-image-1-mini. Use gpt-image-1.5 for best quality (final renders).</p>
                <div class="bp-generate-controls">
                    <label class="bp-generate-control">
                        <span>Quality</span>
                        <select id="bp-gen-quality" aria-label="Image quality">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </label>
                    <label class="bp-generate-control">
                        <span>Model</span>
                        <select id="bp-gen-model" aria-label="Image model">
                            <option value="gpt-image-1-mini">gpt-image-1-mini</option>
                            <option value="gpt-image-1.5">gpt-image-1.5 (final renders)</option>
                            <option value="gpt-image-1">gpt-image-1</option>
                        </select>
                    </label>
                </div>
                <div class="bp-generate-buttons">
                    <button type="button" id="bp-gen-standalone" class="btn-secondary">Generate from standalone prompt</button>
                    <button type="button" id="bp-gen-placeholder" class="btn-secondary">Generate from placeholder prompt</button>
                    <button type="button" id="bp-gen-composite" class="btn-secondary">Generate from composite prompt</button>
                </div>
            </div>
            <div id="bp-gen-result-wrap" class="bp-gen-result-wrap bp-gen-result-hidden" aria-live="polite">
                <p id="bp-gen-result-status" class="bp-gen-result-status"></p>
                <div id="bp-gen-result-image-wrap" class="bp-gen-result-image-wrap"></div>
                <div id="bp-gen-result-actions" class="bp-gen-result-actions bp-gen-result-hidden">
                    <button type="button" id="bp-gen-set-portrait" class="btn-secondary">Set as character portrait</button>
                </div>
            </div>
            <details class="bp-advanced-prompts">
                <summary>Advanced prompts</summary>
                <div class="bp-form-group">
                    <label>Standalone gear prompt</label>
                    <textarea id="bp-standalone-prompt" rows="6" readonly placeholder="Generate to see prompt."></textarea>
                    <button type="button" id="bp-copy-standalone" class="btn-secondary">Copy</button>
                </div>
                <div class="bp-form-group">
                    <label for="bp-placeholder-prompt">Placeholder character prompt (use when no portrait)</label>
                    <textarea id="bp-placeholder-prompt" rows="2" readonly placeholder="Generate to see prompt." aria-label="Placeholder character prompt for use when no portrait"></textarea>
                    <button type="button" id="bp-copy-placeholder" class="btn-secondary">Copy</button>
                </div>
                <div class="bp-form-group">
                    <label>Composite prompt (equip gear on portrait)</label>
                    <p class="help-text">With portrait: equip on your image. Without: use the placeholder character prompt above first, then equip.</p>
                    <textarea id="bp-composite-prompt" rows="6" readonly placeholder="Generate to see prompt."></textarea>
                    <button type="button" id="bp-copy-composite" class="btn-secondary">Copy</button>
                </div>
            </details>
            <section class="bp-form-section">
                <h2>Gallery (download preferred; max 20)</h2>
                <p class="help-text">Add images from file upload or from Generate with OpenAI (stored as URL + metadata). Stored locally; download to keep.</p>
                <input type="file" id="bp-gallery-add" accept="image/*" aria-label="Add image to gallery" class="bp-gallery-add-input">
                <div class="bp-gallery-grid" id="bp-gallery"></div>
            </section>
        </div>

        <div id="bp-confetti-wrap" class="bp-confetti-wrap" aria-hidden="true"></div>

        <div id="bp-lightbox" class="bp-lightbox" role="dialog" aria-modal="true" aria-label="Enlarged image" aria-hidden="true">
            <button type="button" class="bp-lightbox-close" aria-label="Close">×</button>
            <div class="bp-lightbox-backdrop"></div>
            <img class="bp-lightbox-img" src="" alt="Enlarged image">
        </div>
    </div>

    <script src="../../theme.js"></script>
    <script src="data-xp-themes.js"></script>
    <script src="script.js"></script>
</body>
</html>
